# –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω–æ–π LoRa –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã "–∑–∞–≤–∏—Å–∞–Ω–∏—è" —Å–∏—Å—Ç–µ–º—ã

### üéØ **–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

## 1. **–ü–æ—á–µ–º—É —Å–∏—Å—Ç–µ–º–∞ "–∑–∞–≤–∏—Å–∞–µ—Ç"?**
**–°–∏—Å—Ç–µ–º–∞ –ù–ï –∑–∞–≤–∏—Å–∞–µ—Ç!** –û–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø—Ä–æ—Å—Ç–æ:

- **WiFi –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ** - IP 192.168.1.41
- **Initial POST –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** - –Ω–æ –ø–∞–¥–∞–µ—Ç —Å SSL –æ—à–∏–±–∫–æ–π
- **POST task –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** - –ø–æ—Ç–æ–º—É —á—Ç–æ `POST_INTERVAL_EN=0`
- **–û—á–µ—Ä–µ–¥—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫** - –Ω–æ –æ–Ω–∞ –ø—É—Å—Ç–∞—è

**"–ó–∞–≤–∏—Å–∞–Ω–∏–µ" - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:** —Å–∏—Å—Ç–µ–º–∞ –∂–¥–µ—Ç LoRa –ø–∞–∫–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç.

## 2. **POST –∑–∞–ø—Ä–æ—Å—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è?**
**–ù–ï–¢!** –í —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```cpp
#define POST_INTERVAL_EN 0  // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ POST –æ—Ç–∫–ª—é—á–µ–Ω—ã
#define POST_EN_WHEN_LORA_RECEIVED 1  // POST —Ç–æ–ª—å–∫–æ –ø—Ä–∏ LoRa –ø–∞–∫–µ—Ç–∞—Ö
```

**POST task —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ LoRa-only:**
```cpp
if (!POST_INTERVAL_EN) {  // false
  // LoRa-only trigger mode - —Ç–æ–ª—å–∫–æ process queue –∫–∞–∂–¥—ã–µ 500ms
}
```

## 3. **–ö–∞–∫–æ–π —É –Ω–∞—Å —Ç–∞–π–º–∞—É—Ç?**
**client.setTimeout(3000)** - 3 —Å–µ–∫—É–Ω–¥—ã (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

## 4. **–ï—Å—Ç—å –ª–∏ –ø–∞—É–∑–∞ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WiFi?**
**–ù–ï–¢!** –ù–æ —è –¥–æ–±–∞–≤–∏–ª `WIFI_POST_DELAY_MS = 2000` –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### **WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ - –£–°–ü–ï–®–ù–û:**
```
[3947] Network: ISS_Alpha RSSI: -57dBm Ch: 2 Width: 20MHz Auth: WPA2
[4064] Connecting to WiFi SSID: ISS_Alpha
[7413] 4WAY_HANDSHAKE_TIMEOUT - –Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!
[9146] WiFi connected: IP 192.168.1.41
```
- ‚úÖ WiFi –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ handshake timeout
- ‚úÖ IP –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω
- ‚úÖ –°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### **Initial POST - –ù–ï–£–î–ê–ß–ï–ù:**
```
[9172] Sending initial POST on WiFi connect...
[9419] Full HTTP request being sent: POST /api/lora HTTP/1.1...
[129481] start_ssl_client: -1
[129489] Cannot connect to server 84.252.143.212
```
- ‚ùå **SSL handshake –ø–∞–¥–∞–µ—Ç** —Å –æ—à–∏–±–∫–æ–π -1
- ‚ùå **Initial POST –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**
- ‚ùå **–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** –∏–ª–∏ SSL –ø—Ä–æ–±–ª–µ–º–∞

### **POST task - –ù–ï –ó–ê–ü–£–°–ö–ê–ï–¢–°–Ø:**
```
[129499] WiFi enabled
[129499] === QUEUE: Processing queue ===
[129521] Queue is empty, nothing to process
```
- ‚úÖ WiFi –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –û—á–µ—Ä–µ–¥—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
- ‚ùå **POST task –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ POST** (POST_INTERVAL_EN=0)

### **–î–∞–ª—å–Ω–µ–π—à–∞—è —Ä–∞–±–æ—Ç–∞:**
```
[130062] === QUEUE: Processing queue ===
[130078] Queue is empty, nothing to process
```
- üîÑ **–ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—É—Å—Ç–∞—è –æ—á–µ—Ä–µ–¥—å
- üîÑ **LoRa –ø–∞–∫–µ—Ç–æ–≤ –Ω–µ—Ç** - –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- üîÑ **–°–∏—Å—Ç–µ–º–∞ "–∂–¥–µ—Ç" LoRa —Ç—Ä–∞—Ñ–∏–∫–∞**

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã

### **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DEVICE_TYPE=0:**
```cpp
#define POST_INTERVAL_EN 0              // ‚ùå –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ POST –æ—Ç–∫–ª—é—á–µ–Ω—ã
#define POST_EN_WHEN_LORA_RECEIVED 1   // ‚úÖ POST –ø—Ä–∏ LoRa –ø–∞–∫–µ—Ç–∞—Ö
#define FAKE_LORA 0                    // ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ LoRa –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
```

### **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã POST task:**
```cpp
if (POST_INTERVAL_EN) {        // false - –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
  // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ POST –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
} else {                       // –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
  // LoRa-only —Ä–µ–∂–∏–º - —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏
  vTaskDelay(pdMS_TO_TICKS(500));
}
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ LoRa —á–∞—Å—Ç–∏

### **LoRa –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –£–°–ü–ï–®–ù–ê:**
```
LoRa initialized successfully!
LoRa settings: frequency=869.075 MHz, power=20 dBm, SF=11, BW=250 kHz, CR=5
MESH settings: MESH_COMPATIBLE=1
```
- ‚úÖ LoRa –º–æ–¥—É–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ MESH —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω

### **LoRa –ø–∞–∫–µ—Ç—ã - –û–¢–°–£–¢–°–¢–í–£–Æ–¢:**
```
[129538] LoRa packet received, length: 63 bytes
Parsed destination_id: 4294967295, sender_id: 207063648
```
- ‚ö†Ô∏è **–û–¥–∏–Ω –ø–∞–∫–µ—Ç –ø—Ä–∏—à–µ–ª** –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚ùå **–ë–æ–ª—å—à–µ LoRa –ø–∞–∫–µ—Ç–æ–≤ –Ω–µ—Ç** - –Ω–µ—Ç –ø–µ—Ä–µ–¥–∞—é—â–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚ùå **–û—á–µ—Ä–µ–¥—å POST –Ω–µ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è**

## –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üî¥ **–ü—Ä–æ–±–ª–µ–º–∞:**
1. **SSL –æ—à–∏–±–∫–∞ –ø—Ä–∏ initial POST** - —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ SSL –ø—Ä–æ–±–ª–µ–º–∞
2. **POST_INTERVAL_EN=0** - –Ω–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö POST –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **LoRa –ø–∞–∫–µ—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç** - –Ω–µ—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - —É—Å–ø–µ—à–Ω–æ
2. **LoRa –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - —É—Å–ø–µ—à–Ω–∞  
3. **–û—á–µ—Ä–µ–¥—å POST** - —Ä–∞–±–æ—Ç–∞–µ—Ç
4. **POST task** - –∑–∞–ø—É—â–µ–Ω

### üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

#### **1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å SSL –ø—Ä–æ–±–ª–µ–º—É:**
```cpp
// –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å HTTPS –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
#define USE_HTTPS 0
```

#### **2. –í–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ POST –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```cpp
#define POST_INTERVAL_EN 1  // –í–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ POST
```

#### **3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:**
- –°–µ—Ä–≤–µ—Ä 84.252.143.212:443 –¥–æ—Å—Ç—É–ø–µ–Ω?
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω?
- Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞?

#### **4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å FAKE_LORA:**
```cpp
#define FAKE_LORA 1  // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ LoRa
```

## –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞:**
- WiFi –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- LoRa –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
- POST –º–µ—Ö–∞–Ω–∏–∑–º –≥–æ—Ç–æ–≤
- –û—á–µ—Ä–µ–¥—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

### ‚ùå **–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- SSL handshake fails (-1)
- –ù–µ—Ç LoRa —Ç—Ä–∞—Ñ–∏–∫–∞
- POST_INTERVAL_EN=0

### üéØ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å SSL –ø—Ä–æ–±–ª–µ–º—É** (USE_HTTPS=0 –¥–ª—è —Ç–µ—Å—Ç–∞)
2. **–í–∫–ª—é—á–∏—Ç—å POST_INTERVAL_EN=1** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å LoRa –ø–∞–∫–µ—Ç—ã** —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –æ—á–µ—Ä–µ–¥–∏**

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ - –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ!** üöÄ
